webpackJsonp([7],{cUM9:function(e,t){},f35c:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("fZjL"),i=n.n(o),s=n("Dd8w"),c=n.n(s),a=n("mvHQ"),r=n.n(a),l=n("zL8q"),u={name:"plugin-config",components:{"el-dialog":l.Dialog,"el-input":l.Input,"el-checkbox":l.Checkbox,"el-checkbox-group":l.CheckboxGroup,"el-select":l.Select,"el-option":l.Option,"el-button":l.Button,"el-table":l.Table,"el-table-column":l.TableColumn,"el-breadcrumb":l.Breadcrumb,"el-breadcrumb-item":l.BreadcrumbItem,"el-form":l.Form,"el-form-item":l.FormItem,"el-row":l.Row,"el-col":l.Col,"el-card":l.Card},data:function(){return{pluginName:this.$route.params.pluginName,selecting:!1,cancel:!0,defaultOptions:[],configOptions:[],advancedConfig:{},selectedAdvancedConfig:[],record:{},rules:{},configHash:""}},computed:{nodeName:function(){try{return atob(this.$route.params.nodeName)}catch(e){return""}},configChanged:function(){return this.configHash!==r()(this.record)}},methods:{loadConfig:function(){var e=this;this.pluginName.includes("dashboard")?this.$router.hook("/plugins"):this.$httpGet("/nodes/"+this.nodeName+"/plugin_configs/"+this.pluginName).then(function(t){t.data.forEach(function(t){e.defaultOptions.push(c()({selfKey:t.key.replace(/\./g,"__")},t))}),e.handleConfigOptions(),e.cancel=!1}).catch(function(t){e.$message.error(t.message||e.$t("error.networkError"))})},handleConfigOptions:function(){var e=this;this.configOptions=[],this.advancedConfig=[],this.defaultOptions.forEach(function(t){t.key.includes("$id")||(t.value.length<36?e.configOptions.unshift(t):e.configOptions.push(t),e.$set(e.record,t.selfKey,t.value),t.required||t.value||(e.advancedConfig.push(t),e.$delete(e.record,t.selfKey)))}),this.handleValidateRules(),this.configHash=r()(this.record)},handleValidateRules:function(){var e=this;this.rules={},this.configOptions.forEach(function(t){t.required&&(e.rules[t.selfKey]=[{required:!0,message:t.key+" "+e.$t("alert.required")}])})},updateConfig:function(){var e=this;this.$refs.record.validate(function(t){if(t){var n={};i()(e.record).forEach(function(t){e.record[t]&&(n[t.replace(/__/g,".")]=e.record[t])}),e.$httpPut("/nodes/"+e.nodeName+"/plugin_configs/"+e.pluginName,n).then(function(){e.$message.success(e.$t("plugins.configSuccess")),e.configHash=r()(e.record),e.$router.push("/plugins")}).catch(function(){e.$message.error(e.$t("plugins.configFailure"))})}})},cacheConfig:function(){var e=this;this.configChanged?this.$confirm(this.$t("plugins.giveUpNotice"),"Notice",{confirmButtonClass:"confirm-btn",confirmButtonText:this.$t("oper.confirm"),cancelButtonClass:"cache-btn el-button--text",cancelButtonText:this.$t("oper.cancel"),type:"warning"}).then(function(){e.$message.warning(e.$t("plugins.cacheNotice")),e.cancel=!0,e.$router.push("/plugins")}).catch():(this.cancel=!0,this.$router.push("/plugins"))},moreConfig:function(){var e=this,t=[];this.selectedAdvancedConfig.forEach(function(n){void 0===e.record[n.selfKey]&&e.$set(e.record,n.selfKey,n.value),t.push(n.selfKey)}),this.advancedConfig.forEach(function(n){t.includes(n.selfKey)||e.$delete(e.record,n.selfKey)}),this.selecting=!1}},created:function(){this.loadConfig()},beforeRouteLeave:function(e,t,n){!this.configChanged||this.cancel?n():this.cacheConfig()}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"plugin-config"},[n("div",{staticClass:"page-title"},[n("el-breadcrumb",{attrs:{separator:"/"}},[n("el-breadcrumb-item",{attrs:{to:{path:"/plugins"}}},[e._v(e._s(e.nodeName))]),e._v(" "),n("el-breadcrumb-item",{staticClass:"breadcrumb-name"},[e._v(e._s(e.pluginName))])],1)],1),e._v(" "),n("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.loading,expression:"$store.state.loading"}],staticClass:"el-card--self"},[n("div",{staticClass:"config-dialog",attrs:{slot:"header"},slot:"header"},[n("span",[e._v(e._s(e.pluginName))])]),e._v(" "),0===e.configOptions.length?n("div",{staticClass:"empty-content"},[n("h3",[e._v("\n        "+e._s(e.$t("plugins.emptyConfigOption"))+"\n      ")])]):e._e(),e._v(" "),n("el-form",{ref:"record",attrs:{"label-position":"top",size:"medium",rules:e.rules,model:e.record},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.updateConfig(t)}}},[n("el-row",{attrs:{gutter:20}},e._l(e.configOptions,function(t){return void 0!==e.record[t.selfKey]?n("el-col",{key:t.key,attrs:{span:12}},[n("el-form-item",{attrs:{prop:t.required?t.selfKey:"",label:t.key}},[t.value.length<36?n("el-input",{attrs:{placeholder:t.desc},model:{value:e.record[t.selfKey],callback:function(n){e.$set(e.record,t.selfKey,n)},expression:"record[item.selfKey]"}}):n("el-input",{attrs:{prop:t.required?t.key:"",type:"textarea",rows:2,placeholder:t.desc},model:{value:e.record[t.selfKey],callback:function(n){e.$set(e.record,t.selfKey,n)},expression:"record[item.selfKey]"}})],1)],1):e._e()}),1)],1),e._v(" "),0!==e.configOptions.length?n("div",{staticClass:"operation-area"},[n("el-button",{staticClass:"confirm-btn",attrs:{type:"success",disabled:!e.configChanged},on:{click:e.updateConfig}},[e._v("\n        "+e._s(e.$t("oper.confirm"))+"\n      ")]),e._v(" "),n("el-button",{staticClass:"cache-btn",attrs:{type:"text"},on:{click:e.cacheConfig}},[e._v("\n        "+e._s(e.$t("oper.cancel"))+"\n      ")]),e._v(" "),e.advancedConfig.length>0?n("span",{staticClass:"cache-btn advanced-btn",on:{click:function(t){e.selecting=!0}}},[e._v("\n        "+e._s(e.$t("plugins.advancedConfig"))+"\n      ")]):e._e()],1):e._e(),e._v(" "),e.$store.state.loading||0!==e.configOptions.length?e._e():n("el-button",{attrs:{type:"text",icon:"el-icon-arrow-left"},on:{click:function(t){return e.$router.push("/plugins")}}},[e._v("\n      "+e._s(e.$t("plugins.back"))+"\n    ")])],1),e._v(" "),n("el-dialog",{attrs:{width:"500px",title:e.$t("plugins.advancedConfig"),visible:e.selecting},on:{"update:visible":function(t){e.selecting=t}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.moreConfig(t)}}},[n("div",{staticClass:"advanced-config",attrs:{gutter:20}},[n("el-checkbox-group",{model:{value:e.selectedAdvancedConfig,callback:function(t){e.selectedAdvancedConfig=t},expression:"selectedAdvancedConfig"}},e._l(e.advancedConfig,function(t){return n("el-checkbox",{key:t.key,attrs:{label:t}},[e._v("\n            "+e._s(t.key)+"\n          ")])}),1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{staticClass:"cache-btn",attrs:{type:"text"},on:{click:function(t){e.selecting=!1}}},[e._v("\n        "+e._s(e.$t("oper.cancel"))+"\n      ")]),e._v(" "),n("el-button",{staticClass:"confirm-btn",attrs:{type:"success"},on:{click:e.moreConfig}},[e._v("\n        "+e._s(e.$t("oper.confirm"))+"\n      ")])],1)])],1)},staticRenderFns:[]};var f=n("VU/8")(u,d,!1,function(e){n("cUM9")},null,null);t.default=f.exports}});